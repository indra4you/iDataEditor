<section class="container">
    <h1 class="my-3" aria-label="breadcrumb">
        <ul class="breadcrumb">
            <li class="breadcrumb-item">
                <a routerLink="/term.deposits">Term Deposits</a>
            </li>

            <li class="breadcrumb-item active" aria-current="page">
                {{ haveValidId ? "Edit" : "Add" }}
            </li>
        </ul>
    </h1>
    
    <div *ngIf="haveError" class="alert alert-danger" role="alert">
        <div class="row">
            <div class="col-1">
                <i class="bi bi-patch-exclamation"></i>
            </div>

            <div class="col-11">
                {{ errorMessage }}
            </div>
        </div>
    </div>

    <div *ngIf="isLoading; else showForm" class="placeholder-glow">
        <div class="row">
            <div class="col-lg-4 col-md-5 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>

            <div class="col-lg-3 col-md-4 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-3 col-md-4 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>

            <div class="col-lg-3 col-md-4 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>

            <div class="col-lg-2 col-md-3 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>

            <div class="col-lg-2 col-md-3 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>

            <div class="col-lg-2 col-md-3 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-3 col-md-4 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>

            <div class="col-lg-3 col-md-4 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>

            <div class="col-lg-3 col-md-4 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>
        </div>

        <h3 class="mt-3">
            Names
        </h3>

        <div class="table-responsive">
            <table class="table table-hover align-middle bg-white">
                <colgroup>
                    <col width="3%">
                    <col>
                    <col>
                    <col>
                    <col width="3%">
                </colgroup>

                <thead>
                    <tr>
                        <th scope="col">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                        <th scope="col">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                        <th scope="col">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                        <th scope="col">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                        <th scope="col">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                    </tr>
                </thead>

                <tbody>
                    <tr>
                        <th scope="row" class="text-end">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                        <td>
                            <span class="form-control col-12 placeholder"></span>
                        </td>
                        <td>
                            <span class="form-control col-12 placeholder"></span>
                        </td>
                        <td>
                            <span class="form-control col-12 placeholder"></span>
                        </td>
                        <td>
                            <button type="button" disabled class="btn btn-danger col-4 placeholder">
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h3 class="mt-3">Institution</h3>

        <div class="row">
            <div class="col-lg-4 col-md-5 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>

            <div class="col-lg-8 col-md-7 mb-3">
                <label class="form-label col-5 placeholder"></label>

                <span class="form-control col-12 placeholder"></span>
            </div>
        </div>

        <h3 class="mt-3">
            Nominees
        </h3>

        <div class="table-responsive">
            <table class="table table-hover align-middle bg-white">
                <colgroup>
                    <col width="3%">
                    <col>
                    <col>
                    <col>
                    <col width="5%">
                    <col width="3%">
                </colgroup>

                <thead>
                    <tr>
                        <th scope="col">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                        <th scope="col">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                        <th scope="col">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                        <th scope="col">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                        <th scope="col" class="text-end">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                        <th scope="col">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                    </tr>
                </thead>

                <tbody>
                    <tr>
                        <th scope="row" class="text-end">
                            <span class="form-control col-12 placeholder"></span>
                        </th>
                        <td>
                            <span class="form-control col-12 placeholder"></span>
                        </td>
                        <td>
                            <span class="form-control col-12 placeholder"></span>
                        </td>
                        <td>
                            <span class="form-control col-12 placeholder"></span>
                        </td>
                        <td class="text-end">
                            <span class="form-control col-12 placeholder"></span>
                        </td>
                        <td>
                            <button type="button" disabled class="btn btn-danger col-4 placeholder">
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="mb-3">
            <label class="form-label col-5 placeholder"></label>

            <span class="form-control col-12 placeholder"></span>
        </div>

        <button type="button" disabled class="btn btn-primary col-lg-1 col-md-2 col-4 placeholder">
        </button>

        <button type="button" disabled class="btn btn-secondary ms-2 col-lg-1 col-md-2 col-4 placeholder">
        </button>
    </div>

    <ng-template #showForm>
        <div [formGroup]="mainFormGroup">
            <fieldset>
                <div class="row">
                    <div class="col-lg-4 col-md-5 mb-3">
                        <label for="accountNumber" class="form-label">Account Number</label>

                        <input type="text" formControlName="accountNumber" id="accountNumber" #focusOn
                            class="form-control" [ngClass]="{ 'is-invalid': mainFormGroupControls.accountNumber.errors, 'is-valid': mainFormGroupControls.accountNumber.valid }">

                        <div *ngIf="mainFormGroupControls.accountNumber.errors" class="invalid-feedback">
                            <div *ngIf="mainFormGroupControls.accountNumber.errors.required">Account Number is required</div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-4 mb-3">
                        <label for="currencyCode" class="form-label">Currency</label>

                        <select formControlName="currencyCode" id="currencyCode"
                            class="form-select" [ngClass]="{ 'is-invalid': mainFormGroupControls.currencyCode.errors, 'is-valid': mainFormGroupControls.currencyCode.valid }">
                            <option *ngFor="let currency of _supportedCurrencies" [value]="currency.code">
                                {{ currency.name }} ({{ currency.symbole }})
                            </option>
                        </select>

                        <div *ngIf="mainFormGroupControls.currencyCode.errors" class="invalid-feedback">
                            <div *ngIf="mainFormGroupControls.currencyCode.errors.required">Currency is required</div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-3 col-md-4 mb-3">
                        <label for="startDate" class="form-label">Start Date</label>

                        <input type="date" formControlName="startDate" id="startDate"
                            class="form-control" [ngClass]="{ 'is-invalid': mainFormGroupControls.startDate.errors, 'is-valid': mainFormGroupControls.startDate.valid }">

                        <div *ngIf="mainFormGroupControls.startDate.errors" class="invalid-feedback">
                            <div *ngIf="mainFormGroupControls.startDate.errors.required">Start Date is required</div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-4 mb-3">
                        <label for="principalAmount" class="form-label">Principal Amount</label>

                        <input type="number" formControlName="principalAmount" id="principalAmount"
                            class="form-control" [ngClass]="{ 'is-invalid': mainFormGroupControls.principalAmount.errors, 'is-valid': mainFormGroupControls.principalAmount.valid }"
                            inputmode="numeric" min="100" step="100">

                        <div *ngIf="mainFormGroupControls.principalAmount.errors" class="invalid-feedback">
                            <div *ngIf="mainFormGroupControls.principalAmount.errors.required">Principal Amount is required</div>
                            <div *ngIf="mainFormGroupControls.principalAmount.errors.min">Principal Amount should be in multiples of 100</div>
                        </div>
                    </div>

                    <div class="col-lg-2 col-md-3 mb-3">
                        <label for="interestRate" class="form-label">Interest Rate</label>

                        <div class="input-group has-validation">
                            <input type="number" formControlName="interestRate" id="interestRate"
                                class="form-control" [ngClass]="{ 'is-invalid': mainFormGroupControls.interestRate.errors, 'is-valid': mainFormGroupControls.interestRate.valid }"
                                inputmode="numeric" min="0.01" max="100.00" step="0.01">
                            
                            <span class="input-group-text">%</span>

                            <div *ngIf="mainFormGroupControls.interestRate.errors" class="invalid-feedback">
                                <div *ngIf="mainFormGroupControls.interestRate.errors.required">Interest Rate is required</div>
                                <div *ngIf="mainFormGroupControls.interestRate.errors.min">Interest Rate cannot be less than 0.01</div>
                                <div *ngIf="mainFormGroupControls.interestRate.errors.max">Interest Rate cannot be more than 100.00</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-2 col-md-3 mb-3">
                        <label for="tenureDays" class="form-label">Tenure Days</label>

                        <input type="number" formControlName="tenureDays" id="tenureDays"
                            class="form-control" [ngClass]="{ 'is-invalid': mainFormGroupControls.tenureDays.errors, 'is-valid': mainFormGroupControls.tenureDays.valid }"
                            inputmode="numeric" min="0" step="1">

                        <div *ngIf="mainFormGroupControls.tenureDays.errors" class="invalid-feedback">
                            <div *ngIf="mainFormGroupControls.tenureDays.errors.required">Tenure Days is required</div>
                            <div *ngIf="mainFormGroupControls.tenureDays.errors.min">Tenure Days cannot be less than 0</div>
                        </div>
                    </div>

                    <div class="col-lg-2 col-md-3 mb-3">
                        <label for="tenureMonths" class="form-label">Tenure Months</label>

                        <input type="number" formControlName="tenureMonths" id="tenureMonths"
                            class="form-control" [ngClass]="{ 'is-invalid': mainFormGroupControls.tenureMonths.errors, 'is-valid': mainFormGroupControls.tenureMonths.valid }"
                            inputmode="numeric" min="0" step="1">

                        <div *ngIf="mainFormGroupControls.tenureMonths.errors" class="invalid-feedback">
                            <div *ngIf="mainFormGroupControls.tenureMonths.errors.required">Tenure Months is required</div>
                            <div *ngIf="mainFormGroupControls.tenureMonths.errors.min">Tenure Months cannot be less than 0</div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-3 col-md-4 mb-3">
                        <label for="maturityDate" class="form-label">Maturity Date</label>

                        <input type="date" formControlName="maturityDate" id="maturityDate"
                            class="form-control" [ngClass]="{ 'is-invalid': mainFormGroupControls.maturityDate.errors, 'is-valid': mainFormGroupControls.maturityDate.valid }">

                        <div *ngIf="mainFormGroupControls.maturityDate.errors" class="invalid-feedback">
                            <div *ngIf="mainFormGroupControls.maturityDate.errors.required">Maturity Date is required</div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-4 mb-3">
                        <label for="maturityAmount" class="form-label">Maturity Amount</label>

                        <input type="number" formControlName="maturityAmount" id="maturityAmount"
                            class="form-control" [ngClass]="{ 'is-invalid': mainFormGroupControls.maturityAmount.errors, 'is-valid': mainFormGroupControls.maturityAmount.valid }"
                            inputmode="numeric" min="100" step="100">

                        <div *ngIf="mainFormGroupControls.maturityAmount.errors" class="invalid-feedback">
                            <div *ngIf="mainFormGroupControls.maturityAmount.errors.required">Maturity Amount is required</div>
                            <div *ngIf="mainFormGroupControls.maturityAmount.errors.min">Maturity Amount cannot be less than 100</div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-4 mb-3">
                        <label for="interestAmount" class="form-label">Interest Amount</label>

                        <input type="number" formControlName="interestAmount" id="interestAmount"
                            class="form-control" [ngClass]="{ 'is-invalid': mainFormGroupControls.interestAmount.errors, 'is-valid': mainFormGroupControls.interestAmount.valid }"
                            inputmode="numeric" min="0" step="1">

                        <div *ngIf="mainFormGroupControls.interestAmount.errors" class="invalid-feedback">
                            <div *ngIf="mainFormGroupControls.interestAmount.errors.required">Interest Amount is required</div>
                            <div *ngIf="mainFormGroupControls.interestAmount.errors.min">Interest Amount cannot be less than 0</div>
                        </div>
                    </div>
                </div>

                <h3 class="mt-3">
                    Names

                    <a href="#" (click)="onAddNameClicked()" class="text-primary ms-2">
                        <i class="bi bi-plus-circle-dotted"></i>
                    </a>
                </h3>

                <div *ngIf="haveNames; else noNames" class="table-responsive border rounded mb-3">
                    <table class="table table-hover align-middle bg-white mb-0">
                        <colgroup>
                            <col width="3%">
                            <col>
                            <col>
                            <col>
                            <col width="3%">
                        </colgroup>

                        <thead>
                            <tr>
                                <th scope="col"></th>
                                <th scope="col">First Name</th>
                                <th scope="col">Middle Name</th>
                                <th scope="col">Last Name</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr *ngFor="let name of nameList; let i = index">
                                <th scope="row" class="text-end">{{ i + 1 }}.</th>
                                <td>{{ name.first }}</td>
                                <td>{{ name.middle }}</td>
                                <td>{{ name.last }}</td>
                                <td>
                                    <button type="button" (click)="onDeleteNameClicked(i)" class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <ng-template #noNames>
                    <div class="lead text-center text-muted py-2">
                        Click
                        <a href="#" (click)="onAddNameClicked()" class="text-primary">
                            <i class="bi bi-plus-circle-dotted"></i>
                        </a>
                        to add a name
                    </div>
                </ng-template>

                <h3 class="mt-3">Institution</h3>

                <div class="row">
                    <div class="col-lg-4 col-md-5 mb-3">
                        <label for="institutionName" class="form-label">Institution Name</label>

                        <input type="text" formControlName="institutionName" id="institutionName"
                            class="form-control" [ngClass]="{ 'is-invalid': mainFormGroupControls.institutionName.errors, 'is-valid': mainFormGroupControls.institutionName.valid }">

                        <div *ngIf="mainFormGroupControls.institutionName.errors" class="invalid-feedback">
                            <div *ngIf="mainFormGroupControls.institutionName.errors.required">Institution Name is required</div>
                        </div>
                    </div>

                    <div class="col-lg-8 col-md-7 mb-3">
                        <label for="institutionBranch" class="form-label">Institution Branch</label>

                        <input type="text" formControlName="institutionBranch" id="institutionBranch"
                            class="form-control" [ngClass]="{ 'is-invalid': mainFormGroupControls.institutionBranch.errors, 'is-valid': mainFormGroupControls.institutionBranch.valid }">

                        <div *ngIf="mainFormGroupControls.institutionBranch.errors" class="invalid-feedback">
                            <div *ngIf="mainFormGroupControls.institutionBranch.errors.required">Institution Branch is required</div>
                        </div>
                    </div>
                </div>

                <h3 class="mt-3">
                    Nominees

                    <a href="#" (click)="onAddNomineeClicked()" class="text-primary ms-2">
                        <i class="bi bi-plus-circle-dotted"></i>
                    </a>
                </h3>

                <div *ngIf="haveNominees; else noNominees" class="table-responsive border rounded mb-3">
                    <table class="table table-hover align-middle bg-white mb-0">
                        <colgroup>
                            <col width="3%">
                            <col>
                            <col>
                            <col>
                            <col width="5%">
                            <col width="3%">
                        </colgroup>

                        <thead>
                            <tr>
                                <th scope="col"></th>
                                <th scope="col">First Name</th>
                                <th scope="col">Middle Name</th>
                                <th scope="col">Last Name</th>
                                <th scope="col" class="text-end">Share</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr *ngFor="let nominee of nomineeList; let i = index">
                                <th scope="row" class="text-end">{{ i + 1 }}.</th>
                                <td>{{ nominee.name.first }}</td>
                                <td>{{ nominee.name.middle }}</td>
                                <td>{{ nominee.name.last }}</td>
                                <td class="text-end">{{ nominee.share }}%</td>
                                <td>
                                    <button type="button" (click)="onDeleteNomineeClicked(i)" class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <ng-template #noNominees>
                    <div class="lead text-center text-muted py-2">
                        Click
                        <a href="#" (click)="onAddNomineeClicked()" class="text-primary">
                            <i class="bi bi-plus-circle-dotted"></i>
                        </a>
                        to add a nominee
                    </div>
                </ng-template>

                <h5 class="mt-3">Features</h5>

                <div class="mb-3">
                    <textarea formControlName="features" id="features"
                        class="form-control"
                        rows="3">
                    </textarea>
                </div>
            </fieldset>

            <button type="button" (click)="onSubmitClicked()" [disabled]="!isFormValid" class="btn btn-primary">
                <i class="bi bi-hdd"></i>
                <span class="ms-2">Save</span>
            </button>

            <a routerLink="/term.deposits" class="btn btn-outline-secondary ms-2">
                <i class="bi bi-x-lg"></i>
                <span class="ms-2">Cancel</span>
            </a>
        </div>
    </ng-template>
</section>

<name-form *ngIf="showNameForm" (onClose)="onNameFormClose($event)"></name-form>

<nominee-form *ngIf="showNomineeForm" (onClose)="onNomineeFormClose($event)"></nominee-form>